const notes=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],chords=[{v:"major",n:"Major (Triad)"},{v:"minor",n:"Minor (Triad)"},{v:"aug",n:"Augmented (+)"},{v:"dim",n:"Diminished (Â°)"},{v:"sus2",n:"Sus2"},{v:"sus4",n:"Sus4"},{v:"maj7",n:"Major 7 (Maj7)"},{v:"m7",n:"Minor 7 (m7)"},{v:"7",n:"Dominant 7"},{v:"m7b5",n:"Half Diminished (m7b5)"},{v:"dim7",n:"Diminished 7 (dim7)"},{v:"mM7",n:"Minor Major 7 (mMaj7)"},{v:"6",n:"Major 6"},{v:"m6",n:"Minor 6"},{v:"9",n:"Dominant 9"},{v:"maj9",n:"Major 9"},{v:"m9",n:"Minor 9"},{v:"add9",n:"Add 9"},{v:"11",n:"Dominant 11"},{v:"13",n:"Dominant 13"}],scales=[{v:"major",n:"Major (Ionian)"},{v:"minor",n:"Minor (Aeolian)"},{v:"major pentatonic",n:"Major Pentatonic"},{v:"minor pentatonic",n:"Minor Pentatonic"},{v:"blues",n:"Blues"},{v:"dorian",n:"Dorian"},{v:"phrygian",n:"Phrygian"},{v:"lydian",n:"Lydian"},{v:"mixolydian",n:"Mixolydian"},{v:"locrian",n:"Locrian"},{v:"harmonic minor",n:"Harmonic Minor"},{v:"melodic minor",n:"Melodic Minor"},{v:"whole tone",n:"Whole Tone"},{v:"diminished",n:"Diminished (H-W)"}];let currentTuning=["E2","A2","D3","G3","B3","E4"],metroLoop,isMetroPlaying=!1,currentBeat=0,timeSignature=4,metroSynthStrong,metroSynthWeak;function init(){"undefined"!=typeof Tone&&((metroSynthStrong=new Tone.MembraneSynth({pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4}}).toDestination()).volume.value=-8,(metroSynthWeak=new Tone.MembraneSynth({pitchDecay:.05,octaves:8,oscillator:{type:"sine"},envelope:{attack:.001,decay:.3,sustain:.01,release:1.2}}).toDestination()).volume.value=-12);let e=document.getElementById("root-note");e&&notes.forEach(t=>e.innerHTML+=`<option value="${t}">${t}</option>`),document.getElementById("mode-type")?.addEventListener("change",()=>{populateSubTypeOptions(),update()}),document.getElementById("root-note")?.addEventListener("change",update),document.getElementById("sub-type")?.addEventListener("change",update),document.getElementById("tuning-select")?.addEventListener("change",e=>{let t=e.target.value;switch(t){case"halfStep":currentTuning=["Eb2","Ab2","Db3","Gb3","Bb3","Eb4"];break;case"dStd":currentTuning=["D2","G2","C3","F3","A3","D4"];break;case"dropD":currentTuning=["D2","A2","D3","G3","B3","E4"];break;case"dropCs":currentTuning=["Db2","Ab2","Db3","Gb3","Bb3","Eb4"];break;case"dropC":currentTuning=["C2","G2","C3","F3","A3","D4"];break;case"openG":currentTuning=["D2","G2","D3","G3","B3","D4"];break;case"openD":currentTuning=["D2","A2","D3","F#3","A3","D4"];break;case"openE":currentTuning=["E2","B2","E3","G#3","B3","E4"];break;case"dadgad":currentTuning=["D2","A2","D3","G3","A3","D4"];break;default:currentTuning=["E2","A2","D3","G3","B3","E4"]}buildFretboard()}),document.getElementById("lefty-btn")?.addEventListener("click",e=>{let t=document.querySelector(".fretboard-container");t.classList.toggle("lefty-mode");let n=e.currentTarget.querySelector(".hand-text");n&&(n.innerText=t.classList.contains("lefty-mode")?"Left":"Right")});let t=document.getElementById("scroller");document.getElementById("scroll-left")?.addEventListener("click",()=>t.scrollBy({left:-200,behavior:"smooth"})),document.getElementById("scroll-right")?.addEventListener("click",()=>t.scrollBy({left:200,behavior:"smooth"}));let n=document.getElementById("metro-footer"),r=document.getElementById("drawer-toggle");r&&(r.onclick=()=>n.classList.toggle("collapsed")),window.innerWidth<768&&n?.classList.add("collapsed");let a=document.getElementById("bpm-slider"),o=document.getElementById("bpm-display");a&&(a.oninput=e=>{let t=e.target.value;o&&(o.innerText=t),"undefined"!=typeof Tone&&(Tone.Transport.bpm.value=t)});let i=document.getElementById("time-signature");i&&i.addEventListener("change",e=>{timeSignature=parseInt(e.target.value),updateBeatIndicators(),isMetroPlaying&&(stopMetronome(),setTimeout(()=>startMetronome(),100))});let l=document.getElementById("metro-btn");l&&(l.onclick=async()=>{"undefined"!=typeof Tone&&("running"!==Tone.context.state&&await Tone.start(),isMetroPlaying?stopMetronome():startMetronome())});let s=document.getElementById("header-toggle"),c=document.querySelector(".control-panel");s&&(s.onclick=()=>c.classList.toggle("landscape-collapsed")),populateSubTypeOptions(),buildFretboard(),updateBeatIndicators(),updateScaleIndicator()}function updateBeatIndicators(){let e=document.querySelector(".beat-indicators");if(e){e.innerHTML="";for(let t=0;t<timeSignature;t++){let n=document.createElement("div");n.className="beat-indicator",e.appendChild(n)}}}function startMetronome(){currentBeat=0,metroLoop=new Tone.Loop(e=>{0===currentBeat?metroSynthStrong.triggerAttackRelease("C2","16n",e):metroSynthWeak.triggerAttackRelease("C1","16n",e),Tone.Draw.schedule(()=>{document.querySelectorAll(".beat-indicator").forEach((e,t)=>{e.classList.toggle("active",t===currentBeat)})},e),currentBeat=(currentBeat+1)%timeSignature},"4n").start(0),Tone.Transport.start(),document.getElementById("metro-btn")?.classList.add("active"),isMetroPlaying=!0}function stopMetronome(){Tone.Transport.stop(),metroLoop&&(metroLoop.stop(),metroLoop.dispose()),document.getElementById("metro-btn")?.classList.remove("active"),isMetroPlaying=!1,currentBeat=0,document.querySelectorAll(".beat-indicator").forEach(e=>e.classList.remove("active"))}function buildFretboard(){let e=document.getElementById("fretboard");if(e){e.innerHTML="";for(let t=5;t>=0;t--){let n=document.createElement("div");n.className="string",n.id=`string-${t}`;for(let r=0;r<=22;r++){let a=Tonal.Note.transpose(currentTuning[t],Tonal.Interval.fromSemitones(r));n.innerHTML+=`<div class="fret"><div class="note" data-pc="${Tonal.Note.pitchClass(a)}"></div></div>`}e.appendChild(n)}buildFretNumbers(),update()}}function buildFretNumbers(){document.querySelector(".fret-numbers-row")?.remove();let e=document.getElementById("scroller");if(!e)return;let t=document.createElement("div");t.className="fret-numbers-row";let n=[3,5,7,9,12,15,17,19,21];for(let r=0;r<=22;r++){let a=document.createElement("div");a.className="fret-number",n.includes(r)&&a.classList.add("key-fret"),a.innerText=0===r?"":r,t.appendChild(a)}e.appendChild(t)}function populateSubTypeOptions(){let e=document.getElementById("mode-type")?.value==="scale",t=document.getElementById("sub-type");t&&(t.innerHTML="",(e?scales:chords).forEach(e=>{t.innerHTML+=`<option value="${e.v}">${e.n}</option>`}))}function updateScaleIndicator(){let e=document.getElementById("root-note")?.value,t=document.getElementById("mode-type")?.value,n=document.getElementById("sub-type")?.value,r=document.getElementById("current-scale-indicator");if(r&&e&&t&&n){let a="chord"===t?Tonal.Chord.get(e+n):Tonal.Scale.get(`${e} ${n}`);r.innerText=`${e} ${a.name||n}`}}function update(){let e=document.getElementById("root-note")?.value,t=document.getElementById("mode-type")?.value,n=document.getElementById("sub-type")?.value;if(!e||!t||!n)return;let r="chord"===t?Tonal.Chord.get(e+n):Tonal.Scale.get(`${e} ${n}`);document.querySelectorAll(".note").forEach(e=>{let t=r.notes.indexOf(e.dataset.pc);if(e.classList.toggle("active",-1!==t),e.innerText=-1!==t?e.dataset.pc:"",-1!==t&&r.intervals){let n=r.intervals[t];e.className="note active "+("1P"===n?"interval-1P":n.includes("3")?"interval-3rd":n.includes("5")?"interval-5th":"interval-other")}}),updateScaleIndicator()}window.onload=init;
